<link rel="import" href="../../../bower_components/app-route/app-route.html">
<link rel="import" href="../../../bower_components/font-roboto/roboto.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="torrent-item.html">

<dom-module id="layout-project">
  <template>
    <style>
    paper-toolbar {
      --paper-toolbar-background: var(--paper-teal-500);
      --paper-toolbar-color: white;
    }
    
    .body1 {
      @apply(--paper-font-body1);
    }
    
    .color {
      color: #757575;
    }
    
    .footer {
      min-height: 88px;
    }
    
    .li .title {
      padding: 8px;
    }
    
    .spinner,
    .spinner > div {
      padding: 8px;
    }
    </style>

    <app-route pattern="/:layout_project" query-params="{{route_query}}" route="{{route}}"></app-route>

    <firebase-document app-name="TA" data="{{firebase_document_user_subscribed_project}}" path="/user/{{user.uid}}/subscribed/{{route_query.project}}"></firebase-document>
    <firebase-document app-name="TA" data="{{firebase_document_project_torrent}}" path="/project/{{route_query.project}}/torrent"></firebase-document>

    <paper-header-panel mode="seamed">
      <paper-toolbar>
        <paper-icon-button icon="arrow-back" on-tap="_back"></paper-icon-button>

        <div class="title"></div>

        <paper-icon-button icon="add-alert" hidden="{{_subscribed(firebase_document_user_subscribed_project}}" on-tap="_add"></paper-icon-button>
        <paper-icon-button icon="filter-list" on-tap="_filter"></paper-icon-button>
        <paper-icon-button icon="refresh" on-tap="_refresh"></paper-icon-button>
      </paper-toolbar>

      <div class="center-justified horizontal layout" hidden="{{torrent_list.length}}">
        <div class="li">
          <div class="horizontal layout title">
            <div class="body1 color cursor-d flex">indexing</div>
          </div>
        </div>
      </div>

      <div class="center-justified horizontal layout" hidden="{{!torrent_list.length}}">
        <div class="li">
          <div class="horizontal layout title">
            <div class="body1 color cursor-d flex"><span>{{torrent_list.length}}</span> item</div>
          </div>
        </div>
      </div>

      <template is="dom-repeat" items="{{torrent_list}}">
        <torrent-item item="{{item}}"></torrent-item>
      </template>

      <div class="center-justified horizontal layout" hidden="{{torrent_list.length}}">
        <div class="li">
          <div class="center-justified horizontal layout spinner">
            <div>
              <paper-spinner active></paper-spinner>
            </div>
          </div>
        </div>
      </div>

      <div class="footer"></div>
    </paper-header-panel>
  </template>
</dom-module>

<script>
(function() {
  Polymer({

    _back: function() {
      history.back();
    },

    _subscribed: function(value) {
      return value === true;
    },

    _torrent_list: function(list, limit) {
      this.set('torrent_list', _.first(_.keys(list).sort(function(A, Z) {
        return list[Z] - list[A];
      }), limit));
    },

    is: "layout-project",

    observers: ['_torrent_list(firebase_document_project_torrent, torrent_list_limit)'],

    properties: {
      torrent_list_limit: {
        type: Number,
        value: 50,
      },
    },

  });
})();
</script>
